<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de C√°maras UFRO - Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #ecf0f1;
            --dark-bg: #34495e;
            --border-color: #bdc3c7;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--primary-color);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .nav-link {
            color: var(--primary-color);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--secondary-color);
            color: white;
        }

        .mode-toggle {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--border-color);
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle-switch.demo {
            background: var(--warning-color);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.demo .toggle-slider {
            transform: translateX(30px);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .mode-indicator {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .mode-real {
            background: var(--success-color);
            color: white;
        }

        .mode-demo {
            background: var(--warning-color);
            color: white;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .success { color: var(--success-color); }
        .warning { color: var(--warning-color); }
        .danger { color: var(--danger-color); }
        .info { color: var(--secondary-color); }

        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        .fallas-table {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th, .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: var(--light-bg);
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-info { background: #cce7ff; color: #004085; }

        .topologia-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .network-map {
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .node {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            transform: scale(1.1);
        }

        .node-core { background: var(--primary-color); }
        .node-distributor { background: var(--secondary-color); }
        .node-endpoint { background: var(--success-color); }
        .node-warning { background: var(--warning-color); }
        .node-error { background: var(--danger-color); }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border-left: 4px solid var(--secondary-color);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid var(--warning-color);
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo">
            <i class="fas fa-video"></i> Sistema C√°maras UFRO
        </div>
        <div class="nav-links">
            <a href="#" class="nav-link active" onclick="mostrarVista('dashboard')">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="#" class="nav-link" onclick="mostrarVista('fallas')">
                <i class="fas fa-exclamation-triangle"></i> Fallas
            </a>
            <a href="#" class="nav-link" onclick="mostrarVista('topologia')">
                <i class="fas fa-project-diagram"></i> Topolog√≠a
            </a>
            <a href="#" class="nav-link" onclick="mostrarVista('reportes')">
                <i class="fas fa-chart-bar"></i> Reportes
            </a>
        </div>
        <div class="mode-toggle">
            <span>Real</span>
            <div class="toggle-switch" id="modeToggle" onclick="cambiarModo()">
                <div class="toggle-slider"></div>
            </div>
            <span>Demo</span>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-shield-alt"></i> Centro de Monitoreo UFRO</h1>
            <p>Sistema integral de gesti√≥n y monitoreo de infraestructura de c√°maras de seguridad</p>
            <div class="mode-indicator" id="modeIndicator">
                MODO REAL - Datos en tiempo real
            </div>
        </div>

        <!-- Vista Dashboard -->
        <div id="dashboard-view" class="view active">
            <div class="stats-grid" id="statsGrid">
                <!-- Se cargan din√°micamente -->
            </div>

            <div class="chart-grid">
                <div class="chart-container">
                    <div class="chart-title">Fallas por Tipo</div>
                    <canvas id="fallasTipoChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Tendencia de Fallas</div>
                    <canvas id="tendenciaChart"></canvas>
                </div>
            </div>

            <div class="chart-grid">
                <div class="chart-container">
                    <div class="chart-title">Distribuci√≥n por Prioridad</div>
                    <canvas id="prioridadChart"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">C√°maras por Edificio</div>
                    <canvas id="edificiosChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Vista Fallas -->
        <div id="fallas-view" class="view">
            <div class="fallas-table">
                <div class="chart-title">
                    <i class="fas fa-list"></i> Registro de Fallas Recientes
                </div>
                <div id="fallasContent">
                    <!-- Se cargan din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Vista Topolog√≠a -->
        <div id="topologia-view" class="view">
            <div class="topologia-container">
                <div class="chart-title">
                    <i class="fas fa-sitemap"></i> Mapa de Topolog√≠a de Red
                </div>
                <div class="alert alert-info">
                    <strong>Info:</strong> Visualizaci√≥n de la topolog√≠a de red y dependencias entre ubicaciones.
                    Los colores indican el estado: Verde (OK), Amarillo (Advertencia), Rojo (Error).
                </div>
                <div class="network-map" id="networkMap">
                    <!-- Se cargan din√°micamente -->
                </div>
            </div>
        </div>

        <!-- Vista Reportes -->
        <div id="reportes-view" class="view">
            <div class="chart-container">
                <div class="chart-title">
                    <i class="fas fa-file-alt"></i> Reportes y An√°lisis
                </div>
                <div id="reportesContent">
                    <div class="row" style="margin-bottom: 2rem;">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h4><i class="fas fa-chart-bar me-2"></i>Informes B√°sicos</h4>
                                </div>
                                <div class="card-body">
                                    <p>Reportes est√°ndar de fallas, mantenimientos y estad√≠sticas</p>
                                    <a href="/informes" class="btn btn-primary">
                                        <i class="fas fa-external-link-alt me-1"></i>Acceder a Informes
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h4><i class="fas fa-network-wired me-2"></i>Informes Avanzados</h4>
                                </div>
                                <div class="card-body">
                                    <p>Mapas de red, an√°lisis por campus y visualizaciones interactivas</p>
                                    <a href="/informes-avanzados" class="btn btn-success">
                                        <i class="fas fa-rocket me-1"></i>Acceder a Avanzados
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <h3>Nuevas Funcionalidades Disponibles:</h3>
                        <div class="row" style="margin-top: 1rem;">
                            <div class="col-md-4">
                                <div class="feature-box">
                                    <i class="fas fa-sitemap fa-2x text-primary"></i>
                                    <h5>Mapas de Red</h5>
                                    <p>Topolog√≠a completa, en cascada y por campus</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="feature-box">
                                    <i class="fas fa-university fa-2x text-success"></i>
                                    <h5>An√°lisis por Campus</h5>
                                    <p>Inventarios y reportes filtrados por ubicaci√≥n</p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="feature-box">
                                    <i class="fas fa-eye fa-2x text-info"></i>
                                    <h5>Visualizaciones</h5>
                                    <p>Diagramas interactivos y mapas jer√°rquicos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <h3>Tipos de Informes:</h3>
                        <ul style="margin-top: 1rem; line-height: 2; columns: 2;">
                            <li>üåê Mapa de Red Completo</li>
                            <li>üîÑ Mapa de Red en Cascada</li>
                            <li>üèõÔ∏è Mapas por Campus</li>
                            <li>üìä Estructura Jer√°rquica</li>
                            <li>üìπ C√°maras por Campus</li>
                            <li>üì¶ Gabinetes por Campus</li>
                            <li>üîå Switches por Campus</li>
                            <li>üîß Fallas por Campus</li>
                            <li>üí∞ Costos por Campus</li>
                            <li>üë• Rendimiento de T√©cnicos</li>
                            <li>üìà An√°lisis de Tendencias</li>
                            <li>üéØ Filtros Avanzados</li>
                        </ul>
                    </div>
                </div>
                
                <style>
                .card {
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    margin-bottom: 1rem;
                }
                .card-header {
                    background: #f8f9fa;
                    padding: 1rem;
                    border-bottom: 1px solid #e0e0e0;
                    border-radius: 8px 8px 0 0;
                }
                .card-body {
                    padding: 1rem;
                }
                .feature-box {
                    text-align: center;
                    padding: 1rem;
                    border: 1px solid #e0e0e0;
                    border-radius: 8px;
                    margin-bottom: 1rem;
                    background: #fff;
                }
                .feature-box h5 {
                    margin: 0.5rem 0;
                    color: var(--primary-color);
                }
                .feature-box p {
                    margin: 0;
                    color: #666;
                    font-size: 0.9rem;
                }
                .btn {
                    padding: 0.5rem 1rem;
                    border: none;
                    border-radius: 4px;
                    text-decoration: none;
                    color: white;
                    display: inline-block;
                    transition: all 0.3s ease;
                }
                .btn-primary {
                    background: var(--secondary-color);
                }
                .btn-success {
                    background: var(--success-color);
                }
                .btn:hover {
                    opacity: 0.9;
                    transform: translateY(-1px);
                }
                .row {
                    display: flex;
                    flex-wrap: wrap;
                    margin: 0 -0.5rem;
                }
                .col-md-4, .col-md-6 {
                    flex: 0 0 auto;
                    padding: 0 0.5rem;
                }
                .col-md-4 {
                    width: 33.333333%;
                }
                .col-md-6 {
                    width: 50%;
                }
                @media (max-width: 768px) {
                    .col-md-4, .col-md-6 {
                        width: 100%;
                    }
                }
                </style>
            </div>
        </div>
    </div>

    <div class="loading" id="loading" style="display: none;">
        <i class="fas fa-spinner fa-spin"></i> Cargando datos...
    </div>

    <script>
        let modoDemo = false;
        let charts = {};

        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            cargarDatos();
            verificarModo();
        });

        function mostrarVista(vista) {
            // Ocultar todas las vistas
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            // Mostrar vista seleccionada
            document.getElementById(vista + '-view').classList.add('active');
            event.target.classList.add('active');
            
            // Cargar datos espec√≠ficos de la vista
            if (vista === 'fallas') {
                cargarFallas();
            } else if (vista === 'topologia') {
                cargarTopologia();
            }
        }

        function cambiarModo() {
            modoDemo = !modoDemo;
            const toggle = document.getElementById('modeToggle');
            const indicator = document.getElementById('modeIndicator');
            
            toggle.classList.toggle('demo', modoDemo);
            
            // Enviar cambio al servidor
            fetch('/api/modo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ demo: modoDemo })
            })
            .then(response => response.json())
            .then(data => {
                indicator.textContent = modoDemo ? 
                    'MODO DEMO - Datos simulados para demostraci√≥n' : 
                    'MODO REAL - Datos en tiempo real';
                indicator.className = 'mode-indicator ' + (modoDemo ? 'mode-demo' : 'mode-real');
                
                // Recargar datos
                cargarDatos();
            });
        }

        function verificarModo() {
            fetch('/api/modo')
            .then(response => response.json())
            .then(data => {
                modoDemo = data.modo === 'DEMO';
                const toggle = document.getElementById('modeToggle');
                const indicator = document.getElementById('modeIndicator');
                
                toggle.classList.toggle('demo', modoDemo);
                indicator.textContent = modoDemo ? 
                    'MODO DEMO - Datos simulados para demostraci√≥n' : 
                    'MODO REAL - Datos en tiempo real';
                indicator.className = 'mode-indicator ' + (modoDemo ? 'mode-demo' : 'mode-real');
            });
        }

        function cargarDatos() {
            mostrarLoading(true);
            
            fetch('/api/estadisticas')
            .then(response => response.json())
            .then(data => {
                actualizarEstadisticas(data);
                actualizarGraficos(data);
                mostrarLoading(false);
            })
            .catch(error => {
                console.error('Error:', error);
                mostrarLoading(false);
            });
        }

        function actualizarEstadisticas(data) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-icon info"><i class="fas fa-server"></i></div>
                    <div class="stat-number">${data.total_racks}</div>
                    <div class="stat-label">Racks Monitoreados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon success"><i class="fas fa-video"></i></div>
                    <div class="stat-number">${data.total_camaras}</div>
                    <div class="stat-label">C√°maras Activas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon ${data.fallas_activas > 0 ? 'danger' : 'success'}">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-number">${data.fallas_activas}</div>
                    <div class="stat-label">Fallas Activas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon warning"><i class="fas fa-clock"></i></div>
                    <div class="stat-number">${data.tiempo_promedio_resolucion}h</div>
                    <div class="stat-label">Tiempo Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon success"><i class="fas fa-chart-line"></i></div>
                    <div class="stat-number">${data.uptime_promedio}%</div>
                    <div class="stat-label">Uptime Promedio</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon info"><i class="fas fa-dollar-sign"></i></div>
                    <div class="stat-number">$${data.costo_mantenimiento_mes}</div>
                    <div class="stat-label">Costo Mensual</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon success"><i class="fas fa-building"></i></div>
                    <div class="stat-number">${data.edificios_monitoreados}</div>
                    <div class="stat-label">Edificios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon warning"><i class="fas fa-bell"></i></div>
                    <div class="stat-number">${data.alertas_pendientes}</div>
                    <div class="stat-label">Alertas Pendientes</div>
                </div>
            `;
        }

        function actualizarGraficos(data) {
            // Gr√°fico de fallas por tipo
            actualizarGraficoTipo(data.fallas_por_tipo);
            
            // Gr√°fico de tendencia
            actualizarGraficoTendencia(data.tendencia_fallas);
            
            // Gr√°fico de prioridad
            actualizarGraficoPrioridad(data.fallas_por_prioridad);
            
            // Gr√°fico de edificios
            actualizarGraficoEdificios(data.camaras_por_edificio);
        }

        function actualizarGraficoTipo(data) {
            const ctx = document.getElementById('fallasTipoChart').getContext('2d');
            if (charts.tipo) charts.tipo.destroy();
            
            charts.tipo = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        data: Object.values(data),
                        backgroundColor: ['#e74c3c', '#f39c12', '#3498db', '#27ae60']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function actualizarGraficoTendencia(data) {
            const ctx = document.getElementById('tendenciaChart').getContext('2d');
            if (charts.tendencia) charts.tendencia.destroy();
            
            charts.tendencia = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.fecha),
                    datasets: [{
                        label: 'Fallas por d√≠a',
                        data: data.map(d => d.count),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function actualizarGraficoPrioridad(data) {
            const ctx = document.getElementById('prioridadChart').getContext('2d');
            if (charts.prioridad) charts.prioridad.destroy();
            
            charts.prioridad = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'Cantidad',
                        data: Object.values(data),
                        backgroundColor: ['#e74c3c', '#f39c12', '#95a5a6']
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function actualizarGraficoEdificios(data) {
            const ctx = document.getElementById('edificiosChart').getContext('2d');
            if (charts.edificios) charts.edificios.destroy();
            
            charts.edificios = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: 'C√°maras',
                        data: Object.values(data),
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function cargarFallas() {
            fetch('/api/fallas')
            .then(response => response.json())
            .then(data => {
                const content = document.getElementById('fallasContent');
                
                if (data.length === 0) {
                    content.innerHTML = '<p class="alert alert-info">No hay fallas registradas.</p>';
                    return;
                }
                
                let html = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Tipo</th>
                                <th>Ubicaci√≥n</th>
                                <th>C√°maras</th>
                                <th>Prioridad</th>
                                <th>Estado</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.forEach(falla => {
                    const prioridadClass = falla.prioridad === 'Alta' ? 'danger' : 
                                          falla.prioridad === 'Media' ? 'warning' : 'info';
                    const estadoClass = falla.estado_falla === 'Reparada' ? 'success' : 
                                       falla.estado_falla === 'En proceso' ? 'warning' : 'danger';
                    
                    html += `
                        <tr>
                            <td>${falla.id}</td>
                            <td>${falla.tipo_falla}</td>
                            <td>${falla.edificio || 'N/A'}</td>
                            <td>${falla.num_camaras || 0}</td>
                            <td><span class="badge badge-${prioridadClass}">${falla.prioridad}</span></td>
                            <td><span class="badge badge-${estadoClass}">${falla.estado_falla}</span></td>
                            <td>${new Date(falla.fecha_inicio).toLocaleDateString()}</td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
                content.innerHTML = html;
            });
        }

        function cargarTopologia() {
            fetch('/api/topologia')
            .then(response => response.json())
            .then(data => {
                const mapContainer = document.getElementById('networkMap');
                mapContainer.innerHTML = '';
                
                // Posicionar nodos
                data.nodos.forEach((nodo, index) => {
                    const nodeElement = document.createElement('div');
                    nodeElement.className = `node node-${nodo.tipo} node-${nodo.estado}`;
                    nodeElement.textContent = nodo.label;
                    nodeElement.title = `${nodo.label} (${nodo.tipo})`;
                    
                    // Posici√≥n simple en grid
                    const x = 50 + (index % 3) * 200;
                    const y = 50 + Math.floor(index / 3) * 150;
                    
                    nodeElement.style.left = x + 'px';
                    nodeElement.style.top = y + 'px';
                    
                    mapContainer.appendChild(nodeElement);
                });
            });
        }

        function mostrarLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Auto-actualizar cada 30 segundos
        setInterval(() => {
            if (document.getElementById('dashboard-view').classList.contains('active')) {
                cargarDatos();
            }
        }, 30000);
    </script>
</body>
</html>