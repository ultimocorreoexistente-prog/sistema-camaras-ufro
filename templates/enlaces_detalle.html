{% extends "base.html" %}

{% block title %}Detalle Enlace - Sistema UFRO{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-6">
            <h2><i class="bi bi-diagram-3"></i> Detalle del Enlace</h2>
        </div>
        <div class="col-md-6 text-end">
            <a href="{{ url_for('enlaces') }}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
            {% if current_user.rol in ['admin', 'supervisor', 'superadmin'] %}
            <a href="{{ url_for('enlaces_editar', id=enlace.id) }}" class="btn btn-warning">
                <i class="bi bi-pencil"></i> Editar
            </a>
            {% endif %}
        </div>
    </div>

    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5>Información General</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Código:</strong> {{ enlace.codigo }}</p>
                    <p><strong>Nombre:</strong> {{ enlace.nombre or 'N/A' }}</p>
                    <p><strong>Tipo de Enlace:</strong>
                        {% if enlace.tipo_enlace == 'Fibra' %}
                        <span class="badge bg-success">{{ enlace.tipo_enlace }}</span>
                        {% elif enlace.tipo_enlace == 'Inalambrico' %}
                        <span class="badge bg-info">{{ enlace.tipo_enlace }}</span>
                        {% else %}
                        <span class="badge bg-secondary">{{ enlace.tipo_enlace }}</span>
                        {% endif %}
                    </p>
                    <p><strong>Estado Conexión:</strong>
                        {% if enlace.estado_conexion == 'Activo' %}
                        <span class="badge bg-success">{{ enlace.estado_conexion }}</span>
                        {% elif enlace.estado_conexion == 'Inactivo' %}
                        <span class="badge bg-danger">{{ enlace.estado_conexion }}</span>
                        {% else %}
                        <span class="badge bg-warning">{{ enlace.estado_conexion }}</span>
                        {% endif %}
                    </p>
                </div>
                <div class="col-md-6">
                    <p><strong>Proveedor:</strong> {{ enlace.proveedor or 'N/A' }}</p>
                    <p><strong>Ancho de Banda:</strong> {{ enlace.ancho_banda_mbps or 'N/A' }} Mbps</p>
                    <p><strong>Fecha Instalación:</strong> {{ enlace.fecha_instalacion.strftime('%d/%m/%Y') if enlace.fecha_instalacion else 'N/A' }}</p>
                    <p><strong>Último Testeo:</strong> {{ enlace.fecha_ultimo_testeo.strftime('%d/%m/%Y') if enlace.fecha_ultimo_testeo else 'N/A' }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-header bg-info text-white">
            <h5>Ubicaciones y Switches</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>Origen</h6>
                    <p><strong>Ubicación:</strong> 
                        {% if enlace.origen_ubicacion %}
                        {{ enlace.origen_ubicacion.campus }} - {{ enlace.origen_ubicacion.edificio }}
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                    <p><strong>Switch:</strong> 
                        {% if enlace.switch_origen %}
                        {{ enlace.switch_origen.codigo }} - {{ enlace.switch_origen.nombre }}
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                </div>
                <div class="col-md-6">
                    <h6>Destino</h6>
                    <p><strong>Ubicación:</strong> 
                        {% if enlace.destino_ubicacion %}
                        {{ enlace.destino_ubicacion.campus }} - {{ enlace.destino_ubicacion.edificio }}
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                    <p><strong>Switch:</strong> 
                        {% if enlace.switch_destino %}
                        {{ enlace.switch_destino.codigo }} - {{ enlace.switch_destino.nombre }}
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-header bg-success text-white">
            <h5>Métricas de Rendimiento</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Latencia:</strong>
                        {% if enlace.latencia_ms %}
                            {% if enlace.latencia_ms < 10 %}
                            <span class="badge bg-success">{{ "%.2f"|format(enlace.latencia_ms) }} ms (Excelente)</span>
                            {% elif enlace.latencia_ms < 50 %}
                            <span class="badge bg-warning">{{ "%.2f"|format(enlace.latencia_ms) }} ms (Aceptable)</span>
                            {% else %}
                            <span class="badge bg-danger">{{ "%.2f"|format(enlace.latencia_ms) }} ms (Crítico)</span>
                            {% endif %}
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                </div>
                <div class="col-md-6">
                    <p><strong>Pérdida de Paquetes:</strong>
                        {% if enlace.porcentaje_perdida_paquetes is not none %}
                            {% if enlace.porcentaje_perdida_paquetes < 1 %}
                            <span class="badge bg-success">{{ "%.2f"|format(enlace.porcentaje_perdida_paquetes) }}% (Óptimo)</span>
                            {% elif enlace.porcentaje_perdida_paquetes < 5 %}
                            <span class="badge bg-warning">{{ "%.2f"|format(enlace.porcentaje_perdida_paquetes) }}% (Aceptable)</span>
                            {% else %}
                            <span class="badge bg-danger">{{ "%.2f"|format(enlace.porcentaje_perdida_paquetes) }}% (Crítico)</span>
                            {% endif %}
                        {% else %}
                        N/A
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    {% if enlace.observaciones %}
    <div class="card mt-3">
        <div class="card-header">
            <h5>Observaciones</h5>
        </div>
        <div class="card-body">
            <p>{{ enlace.observaciones }}</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
